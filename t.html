<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Triangle Fraternity ‚Äî NFC Welcome Card (no-cache, single file) -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Welcome, Sophia! ‚Äî Triangle Fraternity</title>
  <meta name="description" content="A welcoming, playful NFC card for a Triangle guest." />
  <meta name="theme-color" content="#C85A5A" />

  <!-- No-cache (client-side best effort) -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <style>
    /* ===== Theme (Triangle-inspired): Old Rose + Slate ===== */
    :root{
      --rose:#C85A5A; --rose-200:#f6dada;
      --slate-25:#0c0d10; --slate-100:#1A1C24; --slate-600:#6C7486;
      --radius:18px; --shadow-dark:0 12px 32px rgba(0,0,0,.35); --shadow-light:0 10px 25px rgba(0,0,0,.08);
    }
    :root{ /* default dark */
      --bg:var(--slate-25); --card:var(--slate-100); --text:#F4F6FA; --muted:#ACB2C0; --line:rgba(255,255,255,.14); --shadow:var(--shadow-dark);
      color-scheme: dark;
    }
    @media (prefers-color-scheme: light){
      :root{ --bg:#FAFBFF; --card:#FFFFFF; --text:#10131A; --muted:#5B6272; --line:#E7E9F0; --shadow:var(--shadow-light); color-scheme: light; }
    }
    [data-theme="dark"]{ --bg:#0c0d10; --card:#1A1C24; --text:#F4F6FA; --muted:#ACB2C0; --line:rgba(255,255,255,.14); --shadow:var(--shadow-dark); color-scheme: dark;}
    [data-theme="light"]{ --bg:#FAFBFF; --card:#FFFFFF; --text:#10131A; --muted:#5B6272; --line:#E7E9F0; --shadow:var(--shadow-light); color-scheme: light;}

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
      background:var(--bg); color:var(--text); display:flex; flex-direction:column;
    }

    .wrap{max-width:940px; margin:0 auto; width:100%}
    header, footer{padding:16px}
    header .inner, footer .inner{display:flex; align-items:center; justify-content:space-between; gap:12px}
    footer .inner{justify-content:center; opacity:.9; font-size:.95rem}

    .brand{display:flex; align-items:center; gap:14px}
    .crest{height:72px; width:auto; display:block; object-fit:contain; filter: drop-shadow(0 3px 8px rgba(0,0,0,.25))}
    @media (max-width:520px){ .crest{ height:58px } }
    .ghost{background:transparent; border:1px solid var(--line); color:var(--text); padding:10px 14px; border-radius:12px; cursor:pointer}

    main{flex:1}

    /* Hero */
    .hero{padding: clamp(24px, 6vw, 56px) 16px; display:grid; place-items:center}
    .hero-card{
      width:min(920px, 96%); text-align:center;
      background:linear-gradient(180deg, color-mix(in srgb, var(--rose-200), transparent 60%), transparent 100%), var(--card);
      border:1px solid var(--line); border-radius: clamp(16px, 3vw, 24px); box-shadow: var(--shadow);
      padding: clamp(18px, 4vw, 36px); display:grid; gap: clamp(12px, 2.5vw, 24px);
    }
    .hero-top{display:flex; align-items:center; justify-content:center; gap:14px; flex-wrap:wrap}
    .chip{display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; border:1px solid var(--line); background:color-mix(in srgb, var(--card), white 6%); font-weight:600}
    .chip .dot{width:8px; height:8px; border-radius:50%; background:var(--rose)}
    h1{font-size: clamp(1.8rem, 4.6vw, 3rem); margin:0}
    .lead{font-size: clamp(1.05rem, 2.3vw, 1.25rem); color:var(--muted); margin:0}

    /* Press & Hold */
    .hold-wrap{display:grid; place-items:center; margin:6px 0 0}
    .heart{
      width: clamp(160px, 28vw, 220px); height: clamp(160px, 28vw, 220px); border-radius:50%;
      background: radial-gradient(circle at 50% 50%, var(--rose), color-mix(in srgb, var(--rose), black 15%));
      display:grid; place-items:center; box-shadow:var(--shadow), 0 0 0 0 rgba(200, 90, 90, 0.4); position:relative; cursor:pointer;
      user-select:none; -webkit-user-select:none; touch-action:manipulation;
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    .heart:hover{transform:scale(1.05)}
    .heart:active{transform:scale(0.95)}
    .heart.holding{
      animation: pulse 2s ease-out;
      box-shadow:var(--shadow), 0 0 0 8px rgba(200, 90, 90, 0.2), 0 0 40px rgba(200, 90, 90, 0.4);
    }
    @keyframes pulse{
      0%, 100%{transform:scale(1)}
      50%{transform:scale(1.05)}
    }
    .heart::before{ 
      content:"‚ù§"; 
      font-size: clamp(64px, 11vw, 90px); 
      filter: drop-shadow(0 4px 8px rgba(0,0,0,.3));
      transition: all 0.3s ease;
    }
    .heart.holding::before{
      animation: heartbeat 0.6s ease-in-out infinite;
    }
    @keyframes heartbeat{
      0%, 100%{transform:scale(1)}
      25%{transform:scale(1.1)}
      50%{transform:scale(1)}
    }
    .ring{
      position:absolute; 
      inset:-6px; 
      border-radius:50%; 
      border:5px solid transparent;
      border-top-color:rgba(255,255,255,.9);
      border-right-color:rgba(255,255,255,.7);
      border-bottom-color:rgba(255,255,255,.5);
      border-left-color:rgba(255,255,255,.3);
      opacity:0;
      transform:rotate(-90deg);
      transition:opacity 0.3s ease;
    }
    .ring.fill{ 
      opacity:1;
      animation: spin 2s linear;
    }
    @keyframes spin{
      from{transform:rotate(-90deg)}
      to{transform:rotate(270deg)}
    }
    .hint{color:var(--muted); margin-top:12px; font-size:1.05rem; font-weight:500}

    /* Step card */
    .step{padding: clamp(18px, 3.6vw, 28px) 16px 32px; display:grid; place-items:center}
    .panel{
      width:min(720px, 96%); 
      background:var(--card); 
      border:1px solid var(--line); 
      border-radius: var(--radius); 
      box-shadow: var(--shadow); 
      padding: clamp(24px, 5vw, 36px);
      display:flex;
      flex-direction:column;
      align-items:center;
      text-align:center;
      gap:16px;
    }
    .panel h2{margin:0; font-size: clamp(1.3rem, 3.6vw, 1.8rem)}
    .panel p{margin:0; max-width:600px}


    .tips-title{margin:24px 0 12px 0; font-size:1.1rem; font-weight:700; color:var(--rose); text-transform:uppercase; letter-spacing:0.5px; text-align:center}
    .actions{display:flex; gap:10px; flex-wrap:wrap; margin:16px 0 0 0; justify-content:center}
    .secondary{background:transparent; color:var(--text); border:1px solid var(--line); padding:12px 18px; border-radius:12px; cursor:pointer; font-weight:600; transition: all 0.2s ease}
    .secondary:hover{background:color-mix(in srgb, var(--card), white 10%); border-color:var(--rose); transform:translateY(-1px)}
    .secondary:active{transform:translateY(0)}
    .accordion{display:grid; gap:12px; margin-top:0; width:100%; max-width:600px}
    .accordion details{
      background:color-mix(in srgb, var(--card), white 4%); 
      border:1px solid var(--line); 
      border-radius:14px; 
      padding:0; 
      box-shadow:var(--shadow);
      transition: all 0.2s ease;
    }
    .accordion details:hover{border-color:color-mix(in srgb, var(--rose), transparent 50%)}
    .accordion details[open]{border-color:var(--rose)}
    .accordion summary{
      cursor:pointer; 
      font-weight:600; 
      padding:14px 16px;
      list-style:none;
      display:flex;
      align-items:center;
      justify-content:space-between;
      user-select:none;
    }
    .accordion summary::-webkit-details-marker{display:none}
    .accordion summary::after{
      content:'‚Ä∫';
      font-size:1.4rem;
      font-weight:700;
      transform:rotate(90deg);
      transition:transform 0.2s ease;
      color:var(--rose);
    }
    .accordion details[open] summary::after{transform:rotate(-90deg)}
    .accordion details p{padding:0 16px 16px 16px; margin:0; color:var(--muted); line-height:1.6; text-align:left}

    footer a{color:var(--rose); text-decoration:none; font-weight:700; transition:all 0.2s ease}
    footer a:hover{text-decoration:underline; opacity:0.8}

    #confetti{width:100%; max-width:600px; height:240px; display:block; border-radius:12px; margin:0 auto}

    .view{display:none}
    .view.active{display:block; animation:fade .25s ease}
    @keyframes fade { from{opacity:0; transform:translateY(6px)} to{opacity:1; transform:none}}
    .shake{animation:shake .2s linear}
    @keyframes shake{0%{transform:translateX(0)}25%{transform:translateX(-4px)}50%{transform:translateX(4px)}75%{transform:translateX(-3px)}100%{transform:translateX(0)}}
  </style>
</head>
<body>
  <!-- ===== Header ===== -->
  <header>
    <div class="wrap inner">
      <div class="brand">
        <!-- Put your crest here (URL or data URI). Leave empty if you don't want it -->
        <img class="crest" alt="Triangle Fraternity Crest" src="Triangle_Fraternity_Crest.png" />
        <strong>Triangle Fraternity</strong>
      </div>
      <button id="themeToggle" class="ghost" aria-label="Toggle theme">üåì</button>
    </div>
  </header>

  <main>
    <!-- ===== Hero / Welcome ===== -->
    <section class="hero view active" id="landing">
      <div class="hero-card">
        <div class="hero-top">
          <span class="chip"><span class="dot"></span> Welcome Weekend</span>
          <span class="chip">Guest: <strong>Sophia</strong></span>
        </div>

        <h1>Welcome, <span style="color:var(--rose); font-weight:800;">Sophia</span>!</h1>
        <p class="lead">The pledges at Triangle Fraternity are excited to have you visit this weekend. Let's get started.</p>

        <div class="hold-wrap">
          <div class="heart" id="holdHeart" role="button" aria-label="Press and hold to start">
            <div class="ring" id="holdRing"></div>
          </div>
          <br>
          <p class="hint" id="holdHint">Press & hold the heart for 2 seconds.</p>
        </div>
      </div>
    </section>


    <!-- ===== Success ===== -->
    <section class="step view" id="success">
      <div class="panel">
        <canvas id="confetti" aria-hidden="true"></canvas>
        <h2>Welcome to Triangle, Sophia!</h2>
        <p class="lead">We are thrilled to have you here this weekend. The pledges look forward to showing you what makes our chapter special. Whether you need directions, food recommendations, or just want to explore, we are here to help make this a memorable experience.</p>

        <h3 class="tips-title">Weekend Tips</h3>
        <div id="tips" class="accordion"></div>

        <div class="actions">
          <button class="secondary" id="resetBtn">Start Over</button>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="wrap inner">
      <span>Designed & built by <a href="https://askharoun.dev" target="_blank" rel="noopener noreferrer">Thomas Askharoun</a></span>
    </div>
  </footer>

  <script>
    /* ==== Hard no-cache each visit ==== */
    (async () => {
      try {
        if ('caches' in window) {
          const names = await caches.keys();
          await Promise.all(names.map(n => caches.delete(n)));
        }
        if ('serviceWorker' in navigator) {
          const regs = await navigator.serviceWorker.getRegistrations();
          await Promise.all(regs.map(r => r.unregister()));
        }
        window.addEventListener('pageshow', e => { if (e.persisted) location.reload(); });
      } catch {}
    })();

    /* Theme toggle */
    document.querySelector('#themeToggle').addEventListener('click', ()=>{
      const cur = document.documentElement.getAttribute('data-theme');
      const next = cur === 'light' ? 'dark' : (cur === 'dark' ? '' : 'light');
      if (next) document.documentElement.setAttribute('data-theme', next);
      else document.documentElement.removeAttribute('data-theme');
    });

    /* Router helpers */
    function show(id){
      document.querySelectorAll('.view').forEach(v=>{
        const active = v.id === id;
        v.classList.toggle('active', active);
        v.setAttribute('aria-hidden', String(!active));
      });
      // every run is fresh ‚Äî no persistence
      try { sessionStorage.clear(); localStorage.clear(); } catch {}
    }

    /* Press & Hold start */
    (function(){
      const heart = document.getElementById('holdHeart');
      const ring  = document.getElementById('holdRing');
      const hint  = document.getElementById('holdHint');
      let timer=null, held=false;

      function begin(){
        if (held) return;
        heart.classList.add('holding');
        ring.classList.add('fill');
        timer = setTimeout(()=>{
          held = true;
          hint.textContent = "Welcome!";
          show('success');
          runConfetti();
        }, 2000);
      }
      function cancel(){
        heart.classList.remove('holding');
        ring.classList.remove('fill');
        if (timer){ clearTimeout(timer); timer=null; }
      }
      heart.addEventListener('pointerdown', e=>{ e.preventDefault(); begin(); });
      document.addEventListener('pointerup', cancel);
      document.addEventListener('pointercancel', cancel);
      heart.addEventListener('keydown', e=>{ if (e.key==='Enter' || e.key===' ') begin(); });
      heart.setAttribute('tabindex','0');
    })();


    /* Tips */
    (function(){
      const tips = document.getElementById('tips');

      if (tips){
        const data = [
          {title:"Coffee", body:"Saint's Cafe is cozy and close by."},
          {title:"Late night", body:"Canyon Pizza is a classic campus move and it's RIGHT ACROSS from the house."},
          {title:"Photo spot", body:"Old Main lawn at golden hour is perfect for pictures."}
        ];
        data.forEach(({title,body})=>{
          const d=document.createElement('details');
          const s=document.createElement('summary'); s.textContent=title;
          const p=document.createElement('p'); p.textContent=body;
          d.append(s,p); tips.appendChild(d);
        });
      }
    })();

    /* Reset button */
    (function(){
      const resetBtn = document.getElementById('resetBtn');
      if (resetBtn){
        resetBtn.addEventListener('click', ()=>{
          location.reload();
        });
      }
    })();

    /* Confetti - runs continuously */
    function runConfetti(){
      if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
      const canvas = document.getElementById('confetti');
      const ctx = canvas.getContext('2d');
      const DPR = Math.min(window.devicePixelRatio||1, 2);
      const W = canvas.width = canvas.offsetWidth * DPR;
      const H = canvas.height = 240 * DPR;
      const N = 160;
      const parts = Array.from({length:N}, ()=> ({
        x: Math.random()*W, y: Math.random()*-H,
        r: 2 + Math.random()*3,
        vx: -1 + Math.random()*2,
        vy: 1 + Math.random()*2.5,
        a: Math.random()*Math.PI*2
      }));
      (function tick(){
        ctx.clearRect(0,0,W,H);
        parts.forEach(p=>{
          p.x+=p.vx; p.y+=p.vy; p.a+=0.05;
          if (p.y>H){ p.y=-10; p.x=Math.random()*W; }
          ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.a);
          ctx.fillStyle = Math.random()>.5 ? '#C85A5A' : '#ffffff';
          ctx.fillRect(-p.r,-p.r,p.r*2,p.r*2);
          ctx.restore();
        });
        requestAnimationFrame(tick);
      })();
    }
  </script>
</body>
</html>
