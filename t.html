<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Welcome, Sophia! ‚Äî Triangle Fraternity</title>
  <meta name="description" content="A quick, fun welcome card for a Triangle guest." />
  <meta name="theme-color" content="#ffbd59" />

  <!-- No-cache directives (best effort from client) -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <style>
    /* THEME ‚Äî Auto light/dark + manual toggle */
    :root{
      --accent:#ffbd59;
      --radius:16px;
      --shadow-dark:0 10px 30px rgba(0,0,0,.35);
      --shadow-light:0 10px 25px rgba(0,0,0,.08);
    }
    :root{
      --bg:#0b0b0c; --card:#141418; --text:#f2f2f2; --muted:#b9b9be;
      --ink:#111; --line:rgba(255,255,255,.15); --shadow:var(--shadow-dark);
      color-scheme: dark;
    }
    @media (prefers-color-scheme: light){
      :root{ --bg:#fafafa; --card:#ffffff; --text:#111; --muted:#555; --ink:#111; --line:#e6e6e6; --shadow:var(--shadow-light); color-scheme: light; }
    }
    [data-theme="dark"]{ --bg:#0b0b0c; --card:#141418; --text:#f2f2f2; --muted:#b9b9be; --ink:#111; --line:rgba(255,255,255,.15); --shadow:var(--shadow-dark); color-scheme: dark;}
    [data-theme="light"]{ --bg:#fafafa; --card:#ffffff; --text:#111; --muted:#555; --ink:#111; --line:#e6e6e6; --shadow:var(--shadow-light); color-scheme: light;}

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
      background:var(--bg); color:var(--text); display:flex; flex-direction:column;
    }

    .site-header,.site-footer{
      display:flex; align-items:center; justify-content:space-between;
      padding:12px 16px; max-width:860px; margin:0 auto; width:100%;
    }
    .site-footer{justify-content:center; opacity:.85; font-size:.92rem; padding-bottom:22px}
    .brand{display:flex; align-items:center; gap:12px}
    .crest{
      height:56px; width:auto; display:block;
      filter: drop-shadow(0 2px 6px rgba(0,0,0,.25));
    }
    .ghost{
      background:transparent; border:1px solid var(--line);
      color:var(--text); padding:8px 12px; border-radius:12px; cursor:pointer;
    }

    main#app{max-width:860px; margin:0 auto; width:100%; padding:24px 16px; flex:1}
    .view{display:none; gap:14px}
    .view.active{display:flex; flex-direction:column; animation:fade .25s ease}

    h1{font-size:clamp(1.6rem, 6vw, 2.4rem); margin:0 0 8px}
    h2{font-size:clamp(1.3rem, 5vw, 1.8rem); margin:8px 0}
    p{margin:0 0 8px}
    .lead{font-size:1.05rem}
    .muted{color:var(--muted)}
    .accent{color:var(--accent); font-weight:700}
    .credit{opacity:.85}
    .small{font-size:.9rem}

    .cta,.secondary{
      background:var(--accent); border:none; color:#111; font-weight:700; padding:14px 16px;
      border-radius:14px; cursor:pointer; box-shadow: var(--shadow); transform: translateY(0);
      transition: transform .12s ease, filter .2s ease;
    }
    .secondary{background:#222; color:#fff; border:1px solid var(--line)}
    @media (prefers-color-scheme: light){ .secondary{background:#f2f2f2; color:#111} }
    .secondary:hover{filter:brightness(1.06)}
    .cta:active{transform: translateY(1px)}

    .card{background:var(--card); padding:16px; border-radius:var(--radius); box-shadow:var(--shadow); border:1px solid var(--line)}
    input[type=password]{
      background:color-mix(in srgb, var(--card), black 10%); color:var(--text); border:1px solid var(--line);
      padding:12px 14px; border-radius:12px; outline:none; width:100%;
    }
    @media (prefers-color-scheme: light){
      input[type=password]{ background:#fff; color:#111; border:1px solid #e6e6e6;}
    }
    .form-msg{min-height:20px; font-size:.95rem}
    .form-msg.ok{color:#3ddc84}
    .form-msg.err{color:#ff6b6b}

    /* PRESS & HOLD HEART */
    .hold-wrap{display:grid; place-items:center; margin:8px 0 2px}
    .heart{
      width:120px; height:120px; border-radius:22px; background:
        radial-gradient(120px 120px at 50% 50%, var(--accent), #ffdba1);
      display:grid; place-items:center; box-shadow:var(--shadow); position:relative; cursor:pointer;
      user-select:none; -webkit-user-select:none; touch-action:manipulation;
    }
    .heart::before{
      content:"‚ù§"; font-size:56px; filter: drop-shadow(0 2px 4px rgba(0,0,0,.25));
    }
    .ring{
      position:absolute; inset:8px; border-radius:18px; border:3px solid rgba(255,255,255,.6);
      clip-path: inset(0 round 18px);
      transform: scaleX(0); transform-origin:left; transition: transform .2s linear;
    }
    .ring.fill{ transform: scaleX(1) }

    /* keypad */
    .keypad{display:grid; gap:10px}
    .keys{display:grid; grid-template-columns: repeat(3, 1fr); gap:10px}
    .keys button{padding:14px 0; border-radius:12px; border:1px solid var(--line); background:color-mix(in srgb, var(--card), black 10%); color:var(--text); font-size:1.1rem; cursor:pointer}
    @media (prefers-color-scheme: light){ .keys button{ background:#fff; color:#111; } }

    .grid{display:grid; grid-template-columns: repeat(2, 1fr); gap:10px; margin:10px 0}
    .tile{
      aspect-ratio:1/1; border-radius:14px; position:relative; cursor:pointer; box-shadow:var(--shadow);
      background: linear-gradient(135deg, #1f1f25, #2a2a33);
      border:1px solid var(--line);
    }
    @media (prefers-color-scheme: light){ .tile{ background: linear-gradient(135deg, #f2f2f7, #ffffff); } }
    .tile .digit{
      position:absolute; right:8px; bottom:8px; font-weight:800;
      background:#000a; color:#fff; padding:6px 9px; border-radius:10px; opacity:0; transform:translateY(6px);
      transition:opacity .2s ease, transform .2s ease;
    }
    .tile.revealed .digit{opacity:1; transform:translateY(0)}

    .accordion{margin-top:12px; display:grid; gap:8px}
    .accordion details{background:var(--card); border-radius:12px; padding:10px 12px; box-shadow:var(--shadow); border:1px solid var(--line)}
    .accordion summary{cursor:pointer; font-weight:600}

    .actions{display:flex; gap:10px; flex-wrap:wrap; margin:10px 0}
    #confetti{width:100%; height:220px; display:block}

    @keyframes fade { from{opacity:0; transform:translateY(6px)} to{opacity:1; transform:none}}
    .shake{animation:shake .2s linear}
    @keyframes shake{0%{transform:translateX(0)}25%{transform:translateX(-4px)}50%{transform:translateX(4px)}75%{transform:translateX(-3px)}100%{transform:translateX(0)}}
  </style>
</head>
<body>
  <header class="site-header">
    <div class="brand">
      <!-- Drop your crest here: put a URL or data URI in src -->
      <img class="crest" alt="Triangle Fraternity Crest" src="" />
      <span>Triangle Fraternity</span>
    </div>
    <button id="themeToggle" class="ghost" aria-label="Toggle theme">üåì</button>
  </header>

  <main id="app">
    <!-- Landing -->
    <section id="landing" class="view active" aria-labelledby="landingTitle">
      <h1 id="landingTitle">Welcome, <span class="accent">Sophia</span>! üéâ</h1>
      <p class="muted">We‚Äôre hyped you‚Äôre here. Tap & hold to open your card.</p>
      <div class="hold-wrap">
        <div class="heart" id="holdHeart" role="button" aria-label="Press and hold to start">
          <div class="ring" id="holdRing"></div>
        </div>
      </div>
      <p class="hint" id="holdHint">Press & hold the heart for 2 seconds.</p>
      <p class="credit">Designed &amp; built by <strong>Thomas Askharoun</strong></p>
    </section>

    <!-- Code Step -->
    <section id="step3" class="view" aria-labelledby="step3Title" aria-hidden="true">
      <h2 id="step3Title">Final code</h2>
      <p class="muted">Hint: the year PSU Triangle was founded.</p>

      <!-- optional playful tiles that reveal digits when tapped -->
      <div class="grid" id="digitGrid" aria-label="Digit clue grid"></div>

      <form id="codeForm" class="keypad card" autocomplete="off">
        <label for="codeInput" class="sr">Enter code</label>
        <input id="codeInput" type="password" inputmode="numeric" pattern="\\d{4}" maxlength="4" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" aria-describedby="codeMsg" required />
        <div class="keys" id="keys"></div>
        <button class="cta" type="submit">Unlock</button>
        <div class="form-msg" id="codeMsg" aria-live="polite"></div>
      </form>
    </section>

    <!-- Success -->
    <section id="success" class="view" aria-labelledby="successTitle" aria-hidden="true">
      <canvas id="confetti" aria-hidden="true"></canvas>
      <h2 id="successTitle">Welcome to the weekend, Sophia! üí´</h2>
      <p class="lead">We‚Äôre so glad you‚Äôre here with Triangle Fraternity.</p>
      <div class="card">
        <p>If you need anything ‚Äî directions, food recs, or a mini tour ‚Äî just ask. üíõ</p>
        <p class="credit small">Made by <strong>Thomas Askharoun</strong></p>
      </div>
      <div class="actions">
        <button class="secondary" id="tipsToggle">Weekend Tips</button>
        <button class="secondary" id="wifiCopy">Copy Wi-Fi</button>
        <button class="ghost" id="replay">Replay Confetti</button>
      </div>
      <div id="tips" class="accordion" hidden></div>
    </section>
  </main>

  <footer class="site-footer">
    <span>Designed &amp; built by Thomas Askharoun ‚Äî Triangle Fraternity</span>
  </footer>

  <script>
    // Hard no-cache: clear caches + unregister any SWs in this scope every load.
    (async () => {
      try {
        if ('caches' in window) {
          const names = await caches.keys();
          await Promise.all(names.map(n => caches.delete(n)));
        }
        if ('serviceWorker' in navigator) {
          const regs = await navigator.serviceWorker.getRegistrations();
          await Promise.all(regs.map(r => r.unregister()));
        }
        // Bust back/forward cache in some browsers
        window.addEventListener('pageshow', e => { if (e.persisted) location.reload(); });
      } catch {}
    })();

    // Theme toggle
    document.querySelector('#themeToggle').addEventListener('click', ()=>{
      const cur = document.documentElement.getAttribute('data-theme');
      const next = cur === 'light' ? 'dark' : (cur === 'dark' ? '' : 'light');
      if (next) document.documentElement.setAttribute('data-theme', next);
      else document.documentElement.removeAttribute('data-theme');
    });

    // Press & Hold to continue
    (function(){
      const heart = document.getElementById('holdHeart');
      const ring = document.getElementById('holdRing');
      const hint = document.getElementById('holdHint');
      let timer = null, held = false;

      function begin(){
        if (held) return;
        ring.classList.add('fill');
        timer = setTimeout(()=>{
          held = true; hint.textContent = "Nice. Let‚Äôs go ‚ú®";
          show('step3');
        }, 2000);
      }
      function cancel(){
        ring.classList.remove('fill');
        if (timer){ clearTimeout(timer); timer=null; }
      }
      heart.addEventListener('pointerdown', e=>{ e.preventDefault(); begin(); });
      document.addEventListener('pointerup', cancel);
      document.addEventListener('pointercancel', cancel);
      heart.addEventListener('keydown', e=>{ if (e.key==='Enter' || e.key===' ') begin(); });
      heart.setAttribute('tabindex','0');
    })();

    // Build keypad + (optional) playful tiles
    (function(){
      const grid = document.getElementById('digitGrid');
      const codeForm = document.getElementById('codeForm');
      const codeInput = document.getElementById('codeInput');
      const codeMsg = document.getElementById('codeMsg');
      const keys = document.getElementById('keys');

      // four tiles; reveal 1,9,2,8 on tap (cute hint, optional)
      ['1','9','2','8'].forEach(d=>{
        const tile = document.createElement('button');
        tile.type='button'; tile.className='tile'; tile.setAttribute('aria-pressed','false');
        tile.innerHTML = `<span class="digit">${d}</span>`;
        tile.addEventListener('click', ()=>{
          tile.classList.add('revealed');
          tile.setAttribute('aria-pressed','true');
        });
        grid.appendChild(tile);
      });

      // keypad layout
      const layout = ['1','2','3','4','5','6','7','8','9','‚Üê','0','OK'];
      layout.forEach(ch=>{
        const b=document.createElement('button');
        b.type = ch==='OK' ? 'submit' : 'button';
        b.textContent = ch;
        if (ch==='‚Üê') b.setAttribute('aria-label','Backspace');
        b.addEventListener('click', ()=>{
          if (ch==='OK') return;
          if (ch==='‚Üê'){ codeInput.value = codeInput.value.slice(0,-1); }
          else if (codeInput.value.length < 4){ codeInput.value += ch; }
          codeMsg.textContent = '';
        });
        keys.appendChild(b);
      });

      codeForm.addEventListener('submit', e=>{
        e.preventDefault();
        if (codeInput.value === '1928'){
          codeMsg.textContent = 'Unlocked ‚úÖ';
          codeMsg.className = 'form-msg ok';
          setTimeout(()=> show('success'), 450);
          setTimeout(runConfetti, 550);
        } else {
          codeMsg.textContent = 'Not quite. Hint: the year PSU Triangle was founded.';
          codeMsg.className = 'form-msg err';
          codeInput.classList.remove('shake'); void codeInput.offsetWidth; codeInput.classList.add('shake');
        }
      });
    })();

    function show(id){
      document.querySelectorAll('.view').forEach(v=>{
        const active = v.id === id;
        v.classList.toggle('active', active);
        v.setAttribute('aria-hidden', String(!active));
      });
      // Do NOT persist state; every visit is fresh.
      try { sessionStorage.clear(); localStorage.clear(); } catch {}
    }

    // Confetti (lightweight, no libs)
    function runConfetti(){
      if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
      const canvas = document.getElementById('confetti');
      const ctx = canvas.getContext('2d');
      const DPR = Math.min(window.devicePixelRatio||1, 2);
      const W = canvas.width = canvas.offsetWidth * DPR;
      const H = canvas.height = 220 * DPR;
      const N = 160;
      const parts = Array.from({length:N}, ()=> ({
        x: Math.random()*W, y: Math.random()*-H,
        r: 2 + Math.random()*3,
        vx: -1 + Math.random()*2,
        vy: 1 + Math.random()*2.5,
        a: Math.random()*Math.PI*2
      }));
      const end = performance.now()+2500;
      (function tick(){
        ctx.clearRect(0,0,W,H);
        parts.forEach(p=>{
          p.x+=p.vx; p.y+=p.vy; p.a+=0.05;
          if (p.y>H){ p.y=-10; p.x=Math.random()*W; }
          ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.a);
          ctx.fillStyle = Math.random()>.5 ? '#ffbd59' : '#ffffff';
          ctx.fillRect(-p.r,-p.r,p.r*2,p.r*2);
          ctx.restore();
        });
        if (performance.now()<end) requestAnimationFrame(tick);
      })();
    }
  </script>
</body>
</html>
